# 阶段3执行指南 - 分批执行方案

## 📋 总览

阶段3已拆分为 **3 个独立批次**，每批完成后验证再继续。

| 批次 | 文档 | 工作量 | 优先级 | 风险 | 主要内容 |
|------|------|--------|--------|------|---------|
| **Plan3A** | `plan3a-order.md` | 1.5天 | ⭐⭐⭐ 最高 | 低 | 修复构建 + 修复测试 |
| **Plan3B** | `plan3b-order.md` | 1.5天 | ⭐⭐ 中 | 中 | 新增测试覆盖 |
| **Plan3C** | `plan3c-order.md` | 1天 | ⭐ 低 | 低 | 代码质量 + 部署准备 |

**总工作量**：4 天  
**推荐执行方式**：分批执行，每批完成后验证

---

## 🎯 Plan3A：核心修复（必做）

### 目标
- ✅ 修复 Fabric.js 版本冲突
- ✅ 修复 10 个失败测试
- ✅ 测试通过率 100% (85/85)
- ✅ 生产构建成功

### 执行文档
📄 `improve-plan/plan3a-order.md`（314 行）

### 包含内容
- **Part 1**：解决 Fabric.js 版本冲突（0.5天）
  - 删除根目录 fabric 依赖
  - 清理并重新安装
  - 验证构建成功
  
- **Part 2**：修复现有测试失败（1天）
  - 修复 text.test.ts（6个）
  - 修复 objects.test.ts（3个）
  - 修复 image.test.ts（1个）

### 验收标准
- [ ] 根目录无 fabric 依赖
- [ ] `npm run build` 成功
- [ ] `npm test` 通过率 85/85 (100%)
- [ ] 2 个原子提交

### 预期结果
```
Tests: 85 passed, 85 total
Build: Success
Commits: 2
```

---

## 🎯 Plan3B：测试覆盖（建议做）

### 目标
- ✅ 为阶段2新功能添加测试
- ✅ 新增 30+ 个测试用例
- ✅ 测试总数 115+
- ✅ 保持 100% 通过率

### 执行文档
📄 `improve-plan/plan3b-order.md`（490 行）

### 包含内容
- **Part 3**：为阶段2新功能添加测试（1.5天）
  - 新增 canvas-view.test.ts（9个测试）
  - 新增 shape-drag-draw.test.ts（5个测试）
  - 新增 ExportDialog.test.tsx（7个测试）

### 前置条件
- ✅ Plan3A 已完成
- ✅ 当前测试 85/85 通过

### 验收标准
- [ ] 新增 3 个测试文件
- [ ] `npm test` 通过率 115/115 (100%)
- [ ] 1 个原子提交

### 预期结果
```
Tests: 115 passed, 115 total
New files: 3
Commits: 1
```

---

## 🎯 Plan3C：生产准备（可选）

### 目标
- ✅ 优化代码质量
- ✅ 完成部署准备
- ✅ 项目生产就绪

### 执行文档
📄 `improve-plan/plan3c-order.md`（555 行）

### 包含内容
- **Part 4**：代码质量优化（0.5天）
  - 优化 ESLint 规则
  - 添加 Canvas 渲染防抖
  
- **Part 5**：部署准备（0.5天）
  - 创建 .env.example
  - 优化 next.config.js
  - 创建 vercel.json
  - 更新 README

### 前置条件
- ✅ Plan3A 已完成
- ✅ Plan3B 已完成
- ✅ 当前测试 115/115 通过

### 验收标准
- [ ] `npm run lint` 无错误
- [ ] `npm run build` 成功
- [ ] 部署配置完成
- [ ] 2 个原子提交

### 预期结果
```
ESLint: 0 errors
Build: Success
Deployment: Ready
Commits: 2
```

---

## 📝 执行流程

### 第一步：执行 Plan3A
```bash
# 1. 打开文档
open improve-plan/plan3a-order.md

# 2. 复制全部内容

# 3. 粘贴给 Claude Code

# 4. 等待执行完成

# 5. 验证结果
npm run build  # 应该成功
npm test       # 应该 85/85 通过
```

**完成后停下来**，确认：
- ✅ 构建成功
- ✅ 测试全部通过
- ✅ 无新增问题

---

### 第二步：执行 Plan3B
```bash
# 1. 打开文档
open improve-plan/plan3b-order.md

# 2. 复制全部内容

# 3. 粘贴给 Claude Code

# 4. 等待执行完成

# 5. 验证结果
npm test  # 应该 115/115 通过
```

**完成后停下来**，确认：
- ✅ 新测试全部通过
- ✅ 旧测试仍然通过
- ✅ 测试总数正确

---

### 第三步：执行 Plan3C（可选）
```bash
# 1. 打开文档
open improve-plan/plan3c-order.md

# 2. 复制全部内容

# 3. 粘贴给 Claude Code

# 4. 等待执行完成

# 5. 验证结果
npm run lint   # 应该无错误
npm run build  # 应该成功
```

**完成后**，项目达到生产就绪状态！

---

## ⚠️ 注意事项

### 1. 严格按顺序执行
- Plan3A → Plan3B → Plan3C
- 不要跳过或颠倒顺序

### 2. 每批完成后验证
- 运行测试
- 运行构建
- 检查 Git 提交

### 3. 出问题立即停止
- 如果某批执行失败，先修复再继续
- 不要带着问题继续下一批

### 4. 可以选择性执行
- Plan3A：**必做**（修复关键问题）
- Plan3B：**建议做**（提升测试覆盖）
- Plan3C：**可选**（锦上添花）

---

## 📊 最终目标

完成全部 3 批后：

| 指标 | 当前 | 目标 | 提升 |
|------|------|------|------|
| 测试通过率 | 88.2% | 100% | +11.8% |
| 测试用例数 | 85 | 115+ | +30 |
| 构建状态 | ❌ 失败 | ✅ 成功 | 修复 |
| ESLint 错误 | 有 | 0 | 优化 |
| 部署就绪 | ❌ 否 | ✅ 是 | 完成 |

---

## 🎉 完成后

阶段3全部完成后，项目将达到：
- ✅ 生产构建成功
- ✅ 测试覆盖率 100%
- ✅ 代码质量优化
- ✅ 部署配置完成
- ✅ 文档完善

**可以开始部署到 Vercel！** 🚀

---

## 📞 需要帮助？

如果执行过程中遇到问题：
1. 查看详细的执行文档（plan3a/b/c-order.md）
2. 查看完整的改进计划（plan3.md）
3. 向我反馈问题

祝执行顺利！💪

