# Epic 2: 素材库与高级编辑 (Phase 2)

## Epic 概述

**目标**: 极大地丰富设计素材和编辑能力，提升作品的专业度。

**价值**: 让用户能够创建更具视觉冲击力和专业度的封面，满足高质量内容创作需求。

**验收标准**:
- [ ] 提供至少 18 种精选中文字体
- [ ] 支持渐变色背景和马卡龙色系
- [ ] 集成 Lucide 图标库（250+ 图标）
- [ ] AI 去背景成功率 > 90%
- [ ] 图片编辑功能流畅不卡顿

---

## 用户故事

### Story 2.1: 高级字体选择

**故事 ID**: US-201
**优先级**: P0 (最高)
**故事点**: 5

#### 用户故事

作为 **创作者**，我想要 **从精选的中文字体库中选择字体**，以便 **美化我的封面文字，提升设计品质**。

#### 验收标准

**场景 1: 字体库访问**
- [ ] 用户选中文字后，右侧属性面板显示字体选择器
- [ ] 字体选择器显示当前选中的字体名称
- [ ] 用户点击字体选择器，展开字体列表
- [ ] 字体列表显示至少 18 种精选中文字体
- [ ] 每个字体项显示字体名称和预览示例

**场景 2: 字体预览**
- [ ] 悬停在字体列表项上时，显示实时预览
- [ ] 预览使用文字"示例文本"
- [ ] 预览字体大小为 24px
- [ ] 用户可以输入自定义预览文本

**场景 3: 字体加载和切换**
- [ ] 用户选择字体后，文字实时更新为新字体
- [ ] 字体加载时间 < 1 秒（缓存后）
- [ ] 首次使用的字体显示加载提示
- [ ] 字体切换不影响文字内容和其他属性

**场景 4: 字体来源**
- [ ] 字体来源：中文网字计划 (fonts.zeoseven.com)
- [ ] 字体来源：Google Fonts 中文部分
- [ ] 所有字体均为免费商用字体
- [ ] 字体列表标注来源和授权信息

**场景 5: 字体分类**
- [ ] 字体按风格分类：现代、经典、手写、创意
- [ ] 用户可以按分类筛选字体
- [ ] 用户可以搜索字体名称
- [ ] 用户可以收藏常用字体（本地存储）

**场景 6: 性能优化**
- [ ] 字体懒加载：只有选择的字体才会下载
- [ ] 字体缓存：已加载的字体存储在 IndexedDB
- [ ] 支持字体预加载：用户可以预先下载常用字体

#### 技术任务

- [ ] 集成中文网字计划和 Google Fonts
- [ ] 实现字体懒加载机制
- [ ] 创建字体选择器组件
- [ ] 实现字体预览功能
- [ ] 添加字体缓存（IndexedDB）
- [ ] 实现字体搜索和分类
- [ ] 添加字体预加载功能
- [ ] 编写字体加载测试

#### 工作量估算

**前端开发**: 4 天
**设计**: 1 天
**测试**: 1 天
**总计**: 6 天

---

### Story 2.2: 渐变色背景

**故事 ID**: US-202
**优先级**: P0 (最高)
**故事点**: 5

#### 用户故事

作为 **创作者**，我想要 **设置画布为渐变色背景**，以便 **让封面背景更有视觉层次和美感**。

#### 验收标准

**场景 1: 渐变色选择器**
- [ ] 用户点击左侧面板"背景"工具
- [ ] 选择"渐变色"选项卡
- [ ] 显示预设渐变色列表
- [ ] 至少提供 20 种预设渐变
- [ ] 每种渐变显示缩略图预览

**场景 2: 马卡龙色系**
- [ ] 提供专门的"马卡龙色"分类
- [ ] 包含至少 15 种马卡龙色渐变
- [ ] 马卡龙色特点：柔和、低饱和度、温馨感
- [ ] 用户可以一键应用马卡龙色渐变

**场景 3: Gradient Hunt 灵感**
- [ ] 集成 Gradient Hunt 网站的精选渐变
- [ ] 每周更新 10 个热门渐变
- [ ] 用户可以浏览和收藏渐变
- [ ] 收藏的渐变保存在本地存储

**场景 4: 自定义渐变**
- [ ] 用户可以选择渐变方向（0° - 360°）
- [ ] 用户可以设置起始颜色和结束颜色
- [ ] 用户可以添加中间色标（最多 5 个）
- [ ] 实时预览渐变效果
- [ ] 用户可以保存自定义渐变

**场景 5: 渐变类型**
- [ ] 支持线性渐变（默认）
- [ ] 支持径向渐变
- [ ] 用户可以切换渐变类型
- [ ] 径向渐变支持中心点位置调整

**场景 6: 应用和编辑**
- [ ] 用户点击预设渐变立即应用到画布
- [ ] 选中画布背景后，右侧属性面板显示渐变编辑控件
- [ ] 用户可以微调渐变参数
- [ ] 渐变编辑支持撤销/重做

#### 技术任务

- [ ] 创建渐变色选择器组件
- [ ] 实现预设渐变数据库
- [ ] 集成 Gradient Hunt API 或手动更新
- [ ] 实现马卡龙色系生成算法
- [ ] 创建渐变编辑器
- [ ] 实现渐变缓存和收藏功能
- [ ] 编写渐变渲染测试

#### 工作量估算

**前端开发**: 4 天
**设计**: 1 天
**测试**: 1 天
**总计**: 6 天

---

### Story 2.3: 图标和 Emoji

**故事 ID**: US-203
**优先级**: P1 (高)
**故事点**: 5

#### 用户故事

作为 **创作者**，我想要 **从图标库中选择图标并添加 Emoji**，以便 **为封面添加精美的装饰元素和情感表达**。

#### 验收标准

**场景 1: 图标浏览器**
- [ ] 用户点击左侧面板"图标/形状"工具
- [ ] 显示"图标"标签页（默认）
- [ ] 图标以网格形式展示（每行 8-10 个）
- [ ] 每个图标显示缩略图和名称
- [ ] 总共提供至少 250 个 Lucide 图标

**场景 2: 图标搜索**
- [ ] 顶部显示搜索框
- [ ] 用户输入关键词（如"heart"、"star"）实时搜索
- [ ] 搜索响应时间 < 200ms
- [ ] 支持中文关键词搜索（heart -> 心形）
- [ ] 显示搜索结果数量

**场景 3: 图标分类**
- [ ] 图标按类别分组：箭头、媒体、通讯、编辑、文件等
- [ ] 用户可以按类别筛选
- [ ] 支持多选类别（复选框）
- [ ] 显示每个类别的图标数量

**场景 4: 图标选择和应用**
- [ ] 点击图标添加到画布中心位置
- [ ] 新添加的图标默认大小为 48x48px
- [ ] 图标颜色默认为当前描边色
- [ ] 用户可以双击图标进入编辑模式

**场景 5: Emoji 选择器**
- [ ] 切换到"Emoji"标签页
- [ ] Emoji 按类别分组：表情、人物、动物、食物、自然等
- [ ] 至少提供 500 个常用 Emoji
- [ ] 每个 Emoji 显示表情图案和简短描述
- [ ] Emoji 网格响应式布局（移动端自动调整）

**场景 6: 图标属性编辑**
- [ ] 选中图标后，右侧属性面板显示属性控件
- [ ] 用户可以调整图标大小（16px - 200px）
- [ ] 用户可以修改图标颜色（支持描边和填充）
- [ ] 用户可以旋转和翻转图标
- [ ] 用户可以设置图标不透明度

#### 技术任务

- [ ] 集成 Lucide React 图标库
- [ ] 创建图标浏览器组件
- [ ] 实现图标搜索功能
- [ ] 添加图标分类系统
- [ ] 创建 Emoji 选择器组件
- [ ] 实现图标属性面板
- [ ] 添加图标收藏功能
- [ ] 编写图标渲染测试

#### 工作量估算

**前端开发**: 4 天
**测试**: 1 天
**总计**: 5 天

---

### Story 2.4: 图片高级编辑

**故事 ID**: US-204
**优先级**: P0 (最高)
**故事点**: 8

#### 用户故事

作为 **创作者**，我想要 **对图片进行高级编辑操作**，以便 **让图片更好地融入我的设计中**。

#### 验收标准

**场景 1: 圆角设置**
- [ ] 选中图片后，右侧属性面板显示"圆角"滑块
- [ ] 圆角范围：0px - 100px
- [ ] 拖拽滑块实时预览圆角效果
- [ ] 用户可以输入精确数值
- [ ] 圆角计算考虑图片实际尺寸和纵横比

**场景 2: 阴影效果**
- [ ] 右侧属性面板显示阴影设置区域
- [ ] 用户可以设置阴影颜色（颜色选择器）
- [ ] 用户可以调整阴影模糊度（0px - 50px）
- [ ] 用户可以调整阴影偏移 X 轴（-50px - 50px）
- [ ] 用户可以调整阴影偏移 Y 轴（-50px - 50px）
- [ ] 拖拽滑块实时预览阴影效果
- [ ] 阴影与圆角可以同时应用

**场景 3: 滤镜效果**
- [ ] 属性面板显示滤镜预设列表
- [ ] 至少提供 10 种滤镜：黑白、复古、鲜明、柔和、怀旧、鲜艳、冷色调、暖色调、高对比度、低对比度
- [ ] 用户点击滤镜立即应用到图片
- [ ] 滤镜强度可调（0% - 100%）
- [ ] 支持叠加多个滤镜

**场景 4: 亮度和对比度**
- [ ] 用户可以调整图片亮度（-100 - 100）
- [ ] 用户可以调整图片对比度（-100 - 100）
- [ ] 使用滑块控件，实时预览效果
- [ ] 默认值为 0（原始图片）
- [ ] 数值显示在滑块旁边

**场景 5: 镜像翻转**
- [ ] 属性面板提供"水平翻转"按钮
- [ ] 属性面板提供"垂直翻转"按钮
- [ ] 点击按钮立即翻转图片
- [ ] 翻转操作可撤销
- [ ] 可以同时水平和垂直翻转

**场景 6: 裁剪功能**
- [ ] 选中图片后，显示裁剪模式切换按钮
- [ ] 进入裁剪模式后，图片显示裁剪框
- [ ] 裁剪框四角和四边有控制点
- [ ] 用户拖拽控制点调整裁剪区域
- [ ] 裁剪框比例约束（自由、1:1、3:4、4:3、16:9）
- [ ] 点击"应用裁剪"确认操作
- [ ] 点击"取消"恢复原图
- [ ] 裁剪不可逆（提示用户确认）

#### 技术任务

- [ ] 实现 Fabric.js 图片滤镜
- [ ] 创建图片属性面板
- [ ] 实现圆角和阴影效果
- [ ] 添加滤镜引擎
- [ ] 实现亮度和对比度调整
- [ ] 实现镜像翻转功能
- [ ] 创建图片裁剪工具
- [ ] 添加图片编辑历史记录
- [ ] 编写图片编辑测试

#### 工作量估算

**前端开发**: 6 天
**测试**: 2 天
**总计**: 8 天

---

### Story 2.5: AI 去背景

**故事 ID**: US-205
**优先级**: P1 (高)
**故事点**: 5

#### 用户故事

作为 **创作者**，我想要 **一键移除图片的背景**，以便 **让主体图片更好地突出显示**。

#### 验收标准

**场景 1: 触发 AI 去背景**
- [ ] 选中图片后，右侧属性面板显示"AI 去背景"按钮
- [ ] 按钮位置明显（面板顶部或专用区域）
- [ ] 按钮有图标和文字说明
- [ ] 按钮默认启用

**场景 2: 处理过程**
- [ ] 点击按钮后，按钮变为"处理中..."状态
- [ ] 显示进度条或旋转加载图标
- [ ] 显示预估处理时间（如"预计 3-5 秒"）
- [ ] 处理期间禁用其他编辑操作
- [ ] 整个过程不超过 10 秒

**场景 3: 处理结果**
- [ ] 处理成功后，图片背景变为透明
- [ ] 透明区域显示棋盘格图案（预览）
- [ ] 主体图片保持清晰完整
- [ ] 图片边缘平滑，无明显锯齿

**场景 4: 实现方案**
- [ ] 优先使用 Remove.bg API（效果更好）
- [ ] 备选方案：@imgly/background-removal（纯前端模型）
- [ ] 可在设置中切换实现方案
- [ ] API 方案有月度使用限制，提示用户

**场景 5: 错误处理**
- [ ] 网络错误时，显示"网络错误，请重试"提示
- [ ] API 调用失败时，显示"处理失败，请检查网络"提示
- [ ] 达到 API 限额时，提示用户切换到本地模型
- [ ] 提供"重试"和"取消"按钮
- [ ] 处理失败时保留原图

**场景 6: 手动优化**
- [ ] AI 去背景后，用户可以手动微调
- [ ] 提供"还原背景"按钮（撤销操作）
- [ ] 可以对去背景结果应用"锐化"或"平滑"滤镜

#### 技术任务

- [ ] 集成 Remove.bg API
- [ ] 集成 @imgly/background-removal 模型
- [ ] 创建 AI 去背景按钮和 UI
- [ ] 实现处理进度显示
- [ ] 添加错误处理和重试机制
- [ ] 创建手动优化工具
- [ ] 添加使用限额提示
- [ ] 编写 AI 去背景测试

#### 工作量估算

**前端开发**: 4 天
**API 集成**: 1 天
**测试**: 1 天
**总计**: 6 天

---

## Epic 2 总结

### 开发计划

| 故事 | 优先级 | 故事点 | 开发时间 |
|------|--------|--------|----------|
| US-201 高级字体 | P0 | 5 | 6 天 |
| US-202 渐变背景 | P0 | 5 | 6 天 |
| US-203 图标/Emoji | P1 | 5 | 5 天 |
| US-204 图片编辑 | P0 | 8 | 8 天 |
| US-205 AI 去背景 | P1 | 5 | 6 天 |
| **总计** | | **28** | **31 天** |

### 迭代规划

**迭代 1** (6 天): US-201 高级字体 + US-202 渐变背景
- 提升文字和背景的视觉效果
- 重点优化字体加载性能

**迭代 2** (5 天): US-203 图标/Emoji
- 丰富装饰元素
- 实现搜索和分类功能

**迭代 3** (8 天): US-204 图片高级编辑
- 核心图片处理功能
- 包括圆角、阴影、滤镜、裁剪

**迭代 4** (6 天): US-205 AI 去背景 + 优化
- 集成 AI 服务
- 性能优化和 Bug 修复

**迭代 5** (6 天): 集成测试和优化
- 跨功能集成测试
- 性能调优
- 用户体验优化

### 依赖关系

- US-204（图片编辑）依赖 US-103（图片上传）完成
- US-205（AI 去背景）依赖 US-204（图片编辑）完成
- 其他功能相互独立

### 风险评估

**高风险**:
- AI 去背景 API 稳定性和成本
- 字体加载性能（大量字体）
- 图片滤镜性能（大图片处理）

**中风险**:
- Lucide 图标库兼容性
- Gradient Hunt 集成稳定性
- 移动端编辑体验

**低风险**:
- 基本形状编辑
- Emoji 选择器

### 技术里程碑

- **里程碑 1**: 高级字体系统上线 ✅ (迭代 1)
- **里程碑 2**: 渐变色背景支持 ✅ (迭代 1)
- **里程碑 3**: 图标库集成完成 ✅ (迭代 2)
- **里程碑 4**: 完整图片编辑能力 ✅ (迭代 3)
- **里程碑 5**: AI 去背景功能上线 ✅ (迭代 4)
- **里程碑 6**: Phase 2 完成，准备进入 Phase 3 ✅ (迭代 5)
