# Epic 3: AI 能力与图库集成 (Phase 3)

## Epic 概述

**目标**: 集成 AI 和第三方服务，提供智能化、自动化的设计能力，构建产品核心壁垒。

**价值**: 让用户通过 AI 快速生成所需素材，降低设计门槛，提高创作效率。

**验收标准**:
- [ ] AI 生图成功率 > 85%
- [ ] AI 改图准确性 > 80%
- [ ] Unsplash 图库响应时间 < 1 秒
- [ ] 个人图库自动保存成功率 100%
- [ ] 所有 AI 功能支持用户自定义 API Key

---

## 用户故事

### Story 3.1: AI 生图

**故事 ID**: US-301
**优先级**: P0 (最高)
**故事点**: 8

#### 用户故事

作为 **创作者**，我想要 **通过输入文字描述生成图片**，以便 **快速获得所需的素材，无需手动搜索**。

#### 验收标准

**场景 1: 触发 AI 生图**
- [ ] 用户点击左侧面板"AI 生图"按钮
- [ ] 弹出 AI 生图面板
- [ ] 面板顶部显示"Seedream 4.0"标识
- [ ] 显示用户当前 API Key 状态（已配置/未配置）

**场景 2: API Key 配置**
- [ ] 用户未配置 API Key 时，显示配置提示
- [ ] 提供输入框让用户输入 Seedream API Key
- [ ] 支持从本地存储读取已保存的 Key
- [ ] 提供"测试连接"按钮验证 Key 有效性
- [ ] API Key 安全存储在 localStorage（前端）

**场景 3: 提示词输入**
- [ ] 提供大的文本输入框（支持多行）
- [ ] 输入框占位符提示："描述您想要的图片，例如：一只可爱的橘猫在花园里玩耍"
- [ ] 提示词长度限制：10 - 200 个字符
- [ ] 支持中英文输入
- [ ] 显示剩余可输入字符数

**场景 4: 生成参数**
- [ ] 用户可以选择图片尺寸：512x512、768x768、1024x1024
- [ ] 用户可以设置图片质量：标准、高质量
- [ ] 用户可以设置生成数量：1 - 4 张
- [ ] 提供常用参数预设（一键应用）

**场景 5: 生成过程**
- [ ] 点击"生成"按钮后，按钮变为"生成中..."
- [ ] 显示生成进度条
- [ ] 显示预估等待时间（"预计 10-30 秒"）
- [ ] 生成期间显示 Seedream Logo 和加载动画
- [ ] 用户可以取消生成（取消按钮）

**场景 6: 生成结果**
- [ ] 生成成功后，显示缩略图列表
- [ ] 每张图片显示生成参数（尺寸、质量）
- [ ] 提供"重新生成"按钮（使用相同参数）
- [ ] 提供"变体"按钮（微调参数生成）
- [ ] 点击图片查看大图

**场景 7: 添加到画布**
- [ ] 用户点击图片后，图片自动添加到画布中心
- [ ] 图片大小自动适配画布（最大边不超过画布的 80%）
- [ ] 图片添加后保持选中状态
- [ ] 生成失败的图片不显示

**场景 8: 错误处理**
- [ ] API Key 无效时，提示"API Key 错误，请重新配置"
- [ ] 生成失败时，显示错误原因和重试选项
- [ ] 网络错误时，提示"网络错误，请检查网络连接"
- [ ] 达到 API 限额时，提示"本月额度已用完"
- [ ] 提供解决方案链接

#### 技术任务

- [ ] 集成 Seedream 4.0 API
- [ ] 创建 AI 生图面板组件
- [ ] 实现 API Key 管理（存储在 localStorage）
- [ ] 实现提示词验证和长度限制
- [ ] 添加生成进度显示
- [ ] 实现图片预览和选择
- [ ] 添加错误处理和重试机制
- [ ] 实现图片自动保存到个人图库
- [ ] 编写 AI 生图测试

#### 工作量估算

**前端开发**: 6 天
**API 集成**: 2 天
**测试**: 2 天
**总计**: 10 天

---

### Story 3.2: AI 改图

**故事 ID**: US-302
**优先级**: P0 (最高)
**故事点**: 8

#### 用户故事

作为 **创作者**，我想要 **选中图片并通过 AI 修改图片风格**，以便 **让图片符合我的设计需求**。

#### 验收标准

**场景 1: 触发 AI 改图**
- [ ] 用户选中画布上的图片
- [ ] 右侧属性面板显示"AI 改图"区域
- [ ] 提供"改图"按钮
- [ ] 按钮位置在面板顶部（显眼位置）

**场景 2: 改图选项**
- [ ] 提供预设风格选项：卡通、写实、插画、动漫、水彩、油画、素描
- [ ] 每个风格显示预览示例
- [ ] 用户可以选择多个风格进行对比
- [ ] 支持自定义风格描述

**场景 3: 提示词输入**
- [ ] 提供文本输入框
- [ ] 根据选择的风格自动填充提示词
- [ ] 例如选择"卡通"：自动填充"转换为卡通风格"
- [ ] 用户可以修改和补充提示词
- [ ] 提示词限制：10 - 200 字符

**场景 4: 改图预览**
- [ ] 点击"开始改图"后，显示预览模式
- [ ] 原图和改图结果并排显示
- [ ] 显示对比模式切换按钮
- [ ] 预览模式下可以快速比较效果

**场景 5: 应用改图**
- [ ] 用户满意改图效果后，点击"应用"
- [ ] 改图结果替换原图
- [ ] 应用前提示用户确认
- [ ] 提供"撤销"按钮（还原到原图）

**场景 6: 改图记录**
- [ ] 改图历史自动保存
- [ ] 用户可以查看改图前后的对比
- [ ] 改图记录保存在个人图库
- [ ] 支持一键还原到任意历史版本

**场景 7: 性能和限制**
- [ ] 改图处理时间不超过 30 秒
- [ ] 支持的图片格式：JPG、PNG、WebP
- [ ] 图片大小限制：最大 5MB
- [ ] 图片尺寸限制：最小 256x256，最大 1024x1024

#### 技术任务

- [ ] 实现图片上传到 AI 服务
- [ ] 创建 AI 改图面板组件
- [ ] 实现风格预设系统
- [ ] 添加改图预览功能
- [ ] 实现改图历史记录
- [ ] 添加撤销/重做功能
- [ ] 实现图片格式和大小验证
- [ ] 编写 AI 改图测试

#### 工作量估算

**前端开发**: 6 天
**API 集成**: 2 天
**测试**: 2 天
**总计**: 10 天

---

### Story 3.3: Unsplash 图库

**故事 ID**: US-303
**优先级**: P1 (高)
**故事点**: 5

#### 用户故事

作为 **创作者**，我想要 **直接在应用中搜索 Unsplash 高质量图库**，以便 **快速找到合适的图片素材**。

#### 验收标准

**场景 1: 打开图库**
- [ ] 用户点击左侧面板"图库"按钮
- [ ] 默认显示"Unsplash"标签页
- [ ] 显示 Unsplash Logo 和标题
- [ ] 显示搜索框和热门关键词

**场景 2: 搜索功能**
- [ ] 顶部搜索框提示"搜索图片..."
- [ ] 用户输入关键词实时搜索（延迟 300ms）
- [ ] 搜索响应时间 < 1 秒
- [ ] 支持中英文搜索
- [ ] 自动补全热门关键词

**场景 3: 搜索结果**
- [ ] 图片以网格形式展示（每行 3-4 张）
- [ ] 每张图片显示缩略图（低清）
- [ ] 鼠标悬停显示图片信息：尺寸、作者、下载次数
- [ ] 分页加载：每页 20-30 张图片
- [ ] 滚动自动加载下一页

**场景 4: 筛选和排序**
- [ ] 提供排序选项：相关性、最新、最受欢迎
- [ ] 提供方向筛选：横图、竖图、方图
- [ ] 提供颜色筛选：黑白、红、橙、黄、绿、蓝、紫、粉
- [ ] 筛选条件可以叠加使用

**场景 5: 添加图片**
- [ ] 用户点击图片后，弹出预览对话框
- [ ] 预览显示大图和详细信息
- [ ] 提供"添加到画布"按钮
- [ ] 添加成功后显示确认提示
- [ ] 图片自动保存到个人图库

**场景 6: 版权信息**
- [ ] 图片预览显示摄影师信息
- [ ] 图片底部显示"照片作者：XXX"
- [ ] 提供"查看原图"链接（Unsplash 链接）
- [ ] 提供"下载原图"选项（直接跳转 Unsplash）

**场景 7: 性能优化**
- [ ] 缩略图懒加载
- [ ] 图片预加载（临近图片）
- [ ] 搜索结果缓存（24 小时）
- [ ] 离线缓存（已浏览的图片）

#### 技术任务

- [ ] 集成 Unsplash API v1
- [ ] 创建图库面板组件
- [ ] 实现搜索和筛选功能
- [ ] 添加图片懒加载
- [ ] 实现搜索结果缓存
- [ ] 添加图片预览对话框
- [ ] 实现版权信息显示
- [ ] 编写 Unsplash 集成测试

#### 工作量估算

**前端开发**: 4 天
**API 集成**: 1 天
**测试**: 1 天
**总计**: 6 天

---

### Story 3.4: 个人图库管理

**故事 ID**: US-304
**优先级**: P0 (最高)
**故事点**: 5

#### 用户故事

作为 **创作者**，我想要 **我的 AI 生成和编辑的图片被自动保存**，以便 **以后可以重复使用这些素材**。

#### 验收标准

**场景 1: 自动保存**
- [ ] AI 生成的图片自动保存到个人图库
- [ ] AI 改图后的图片自动保存
- [ ] 从 Unsplash 添加的图片自动保存
- [ ] 保存成功后显示"已保存到个人图库"提示

**场景 2: 图库访问**
- [ ] 点击左侧面板"图库"按钮
- [ ] 切换到"个人图库"标签页
- [ ] 显示所有保存的图片
- [ ] 图片按保存时间倒序排列（最新的在前）

**场景 3: 图片管理**
- [ ] 每张图片显示缩略图
- [ ] 鼠标悬停显示图片信息：尺寸、创建时间、来源
- [ ] 图片右键显示操作菜单：删除、重命名、查看详情
- [ ] 支持批量选择和删除
- [ ] 删除前显示确认对话框

**场景 4: 搜索和筛选**
- [ ] 顶部搜索框支持按图片名称搜索
- [ ] 提供来源筛选：AI 生成、AI 改图、Unsplash、上传
- [ ] 提供时间筛选：今天、本周、本月、更早
- [ ] 搜索响应时间 < 200ms

**场景 5: 分类和标签**
- [ ] 用户可以为图片添加标签
- [ ] 标签显示在图片下方
- [ ] 用户可以按标签筛选图片
- [ ] 支持添加多个标签
- [ ] 常用标签自动提示

**场景 6: 收藏夹**
- [ ] 用户可以将图片添加到收藏夹
- [ ] 收藏夹在个人图库中单独分区
- [ ] 提供快速访问"我的收藏"
- [ ] 收藏夹支持重命名

**场景 7: 图片详情**
- [ ] 点击图片进入详情页面
- [ ] 显示大图预览
- [ ] 显示完整元数据：尺寸、文件大小、创建时间、来源、提示词
- [ ] 显示使用记录（在哪里使用过）
- [ ] 提供编辑功能：重命名、添加标签

#### 技术任务

- [ ] 设计个人图库数据模型
- [ ] 实现本地存储（IndexedDB）
- [ ] 创建个人图库面板组件
- [ ] 实现图片自动保存
- [ ] 添加搜索和筛选功能
- [ ] 实现图片管理（删除、重命名）
- [ ] 添加标签和分类系统
- [ ] 实现收藏夹功能
- [ ] 编写个人图库测试

#### 工作量估算

**前端开发**: 4 天
**数据库设计**: 1 天
**测试**: 1 天
**总计**: 6 天

---

## Epic 3 总结

### 开发计划

| 故事 | 优先级 | 故事点 | 开发时间 |
|------|--------|--------|----------|
| US-301 AI 生图 | P0 | 8 | 10 天 |
| US-302 AI 改图 | P0 | 8 | 10 天 |
| US-303 Unsplash 图库 | P1 | 5 | 6 天 |
| US-304 个人图库 | P0 | 5 | 6 天 |
| **总计** | | **26** | **32 天** |

### 迭代规划

**迭代 1** (10 天): US-301 AI 生图
- 集成 Seedream API
- 实现完整的 AI 生图流程
- 重点处理 API Key 管理和错误处理

**迭代 2** (10 天): US-302 AI 改图
- 实现图片风格转换
- 添加改图预览和历史记录
- 与 AI 生图功能整合

**迭代 3** (6 天): US-303 Unsplash 图库
- 集成第三方图库 API
- 实现搜索和筛选功能
- 重点优化性能和用户体验

**迭代 4** (6 天): US-304 个人图库
- 实现完整的素材管理系统
- 与其他功能整合（AI 生成、Unsplash）
- 实现本地存储和缓存

### 依赖关系

- US-304（个人图库）依赖 US-301、US-302、US-303 完成
- US-301 和 US-302 相互独立，可并行开发
- US-303 可独立开发，无依赖

### 风险评估

**高风险**:
- Seedream API 稳定性和可用性
- AI 生图质量和准确性
- 第三方 API 成本和限额
- 图片存储和缓存性能

**中风险**:
- Unsplash API 稳定性
- 移动端大图处理性能
- 用户隐私和数据安全

**低风险**:
- 基础图库功能
- 搜索和筛选

### 技术里程碑

- **里程碑 1**: AI 生图功能上线 ✅ (迭代 1)
- **里程碑 2**: AI 改图功能上线 ✅ (迭代 2)
- **里程碑 3**: Unsplash 图库集成完成 ✅ (迭代 3)
- **里程碑 4**: 个人图库管理系统完成 ✅ (迭代 4)
- **里程碑 5**: Phase 3 完成，准备进入 Phase 4 ✅
- **里程碑 6**: AI 功能用户满意度 > 80% ✅

### 关键指标

- AI 生图成功率：> 85%
- AI 改图准确性：> 80%
- 用户 API Key 配置率：> 60%
- 个人图库使用率：> 70%
- Unsplash 图库搜索转化率：> 40%
