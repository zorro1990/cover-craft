# Epic 1: 核心画布与基础编辑功能 (MVP)

## Epic 概述

**目标**: 搭建应用骨架，实现最基础的图文编辑和导出功能，构成产品的最小可用闭环。

**价值**: 让用户能够在 5 分钟内完成一张基本封面的设计和导出，满足社交媒体发布的即时需求。

**验收标准**:
- [ ] 用户无需教程即可上手
- [ ] 核心操作流程顺畅自然
- [ ] 导出功能稳定可靠
- [ ] 页面加载时间 < 2.5 秒

---

## 用户故事

### Story 1.1: 创建画布

**故事 ID**: US-101
**优先级**: P0 (最高)
**故事点**: 3

#### 用户故事

作为 **创作者**，我想要 **创建一个指定比例的画布**，以便 **开始我的封面设计工作**。

#### 验收标准

**场景 1: 默认画布**
- [ ] 页面加载时自动创建一个默认画布 (3:4 比例)
- [ ] 画布显示在页面中心，清晰可见
- [ ] 画布背景为白色或用户可选择的纯色

**场景 2: 选择画布比例**
- [ ] 用户可以在顶部工具栏看到画布尺寸选择器
- [ ] 支持的尺寸：3:4 (1080x1440)、1:1 (1080x1080)、4:3 (1080x810)、21:9 (1080x462)
- [ ] 用户点击尺寸选项后，画布立即调整到对应尺寸
- [ ] 尺寸切换过程中，画布内容保持相对位置不变

**场景 3: 画布操作**
- [ ] 用户可以拖拽画布内容到合适位置
- [ ] 用户可以通过鼠标滚轮缩放画布视图
- [ ] 用户可以通过快捷键重置画布视图 (Ctrl+0)

**场景 4: 设置画布背景**
- [ ] 用户可以通过顶部工具栏选择"背景"工具
- [ ] 用户可以从预设颜色中选择背景色
- [ ] 用户可以输入自定义颜色值 (#000000 - #ffffff)
- [ ] 背景色变更实时生效

#### 技术任务

- [ ] 实现 Fabric.js Canvas 初始化
- [ ] 创建画布比例选择器组件
- [ ] 实现背景色切换功能
- [ ] 添加画布缩放和拖拽交互
- [ ] 编写单元测试 (覆盖率 > 80%)

#### 工作量估算

**前端开发**: 2 天
**测试**: 0.5 天
**总计**: 2.5 天

---

### Story 1.2: 添加和编辑文字

**故事 ID**: US-102
**优先级**: P0 (最高)
**故事点**: 5

#### 用户故事

作为 **创作者**，我想要 **在画布上添加和编辑文字**，以便 **在封面上添加标题和说明信息**。

#### 验收标准

**场景 1: 添加文字**
- [ ] 用户点击左侧面板"文字"工具
- [ ] 鼠标在画布上点击后立即显示一个文本框
- [ ] 文本框带有可识别的边框和选中状态
- [ ] 文本框显示默认文字"点击编辑"

**场景 2: 编辑文字内容**
- [ ] 双击文本框进入编辑模式
- [ ] 文本框出现可编辑的光标
- [ ] 用户可以输入、删除、修改文字内容
- [ ] 文字支持中英文混合输入
- [ ] 按 Enter 键或点击画布其他区域完成编辑

**场景 3: 文字样式编辑**
- [ ] 选中文字后，右侧属性面板显示文字属性
- [ ] 用户可以修改字体（默认字体 + 至少 10 种免费字体）
- [ ] 用户可以调整字体大小（12px - 200px）
- [ ] 用户可以修改字体颜色（颜色选择器 + 自定义输入）
- [ ] 用户可以设置文字背景色（可选）

**场景 4: 文字位置和变换**
- [ ] 用户可以拖拽文本框改变位置
- [ ] 用户可以拖拽文本框四个角的控制点调整大小
- [ ] 用户可以拖拽文本框顶部的旋转控制点旋转文字
- [ ] 用户可以使用方向键微调文字位置（Shift+方向键 = 10px 步长）
- [ ] 用户可以使用 Delete 键删除选中的文字

**场景 5: 文字对齐和格式**
- [ ] 用户可以设置文字对齐方式（左对齐、居中、右对齐、两端对齐）
- [ ] 用户可以设置文字加粗、斜体
- [ ] 用户可以调整行间距和字间距

#### 技术任务

- [ ] 实现 Fabric.js Text 对象操作
- [ ] 创建文字工具按钮和面板
- [ ] 实现文字编辑功能（可编辑模式）
- [ ] 创建文字属性面板组件
- [ ] 实现字体加载和切换功能
- [ ] 添加快捷键支持
- [ ] 编写集成测试

#### 工作量估算

**前端开发**: 4 天
**测试**: 1 天
**总计**: 5 天

---

### Story 1.3: 上传和使用图片

**故事 ID**: US-103
**优先级**: P0 (最高)
**故事点**: 5

#### 用户故事

作为 **创作者**，我想要 **从本地上传图片并添加到画布中**，以便 **使用自己的素材制作封面**。

#### 验收标准

**场景 1: 上传图片**
- [ ] 用户点击左侧面板"图片"工具
- [ ] 用户点击"上传图片"按钮
- [ ] 系统打开文件选择对话框
- [ ] 用户可以上传 JPG、PNG、WebP 格式图片
- [ ] 最大文件大小为 10MB
- [ ] 上传成功后，图片立即显示在画布上

**场景 2: 图片操作**
- [ ] 用户可以拖拽图片改变位置
- [ ] 用户可以拖拽图片四个角的控制点缩放图片
- [ ] 用户可以拖拽图片顶部的旋转控制点旋转图片
- [ ] 缩放时图片比例保持不变（锁定纵横比）
- [ ] 用户可以使用 Delete 键删除选中的图片

**场景 3: 图片属性**
- [ ] 选中图片后，右侧属性面板显示图片信息
- [ ] 显示图片原始尺寸和当前尺寸
- [ ] 用户可以输入具体数值调整图片尺寸
- [ ] 用户可以输入角度值精确旋转图片
- [ ] 用户可以设置图片不透明度（0% - 100%）

**场景 4: 错误处理**
- [ ] 上传不支持的文件格式时，显示清晰的错误提示
- [ ] 文件超过 10MB 时，显示文件大小超限提示
- [ ] 上传失败时，显示重试按钮
- [ ] 支持拖拽上传：用户可以直接将图片拖拽到左侧面板

**场景 5: 图片性能**
- [ ] 大图片自动压缩到适合画布的尺寸
- [ ] 图片加载有进度提示（适用于大文件）
- [ ] 上传过程中禁用上传按钮，避免重复提交

#### 技术任务

- [ ] 实现文件上传功能（支持拖拽）
- [ ] 实现图片类型和大小验证
- [ ] 创建 Fabric.js Image 对象操作
- [ ] 实现图片缩放、旋转、位置调整
- [ ] 添加图片压缩优化
- [ ] 实现错误处理和用户提示
- [ ] 编写测试用例

#### 工作量估算

**前端开发**: 4 天
**测试**: 1 天
**总计**: 5 天

---

### Story 1.4: 绘制基本形状

**故事 ID**: US-104
**优先级**: P1 (高)
**故事点**: 3

#### 用户故事

作为 **创作者**，我想要 **使用快捷键快速绘制基本形状**，以便 **在封面上添加简单的装饰元素**。

#### 验收标准

**场景 1: 绘制矩形**
- [ ] 用户按 R 键进入矩形绘制模式
- [ ] 鼠标在画布上点击并拖拽可以绘制矩形
- [ ] 释放鼠标后，矩形固定在画布上
- [ ] 矩形具有默认的描边和填充（可后续修改）

**场景 2: 绘制圆形**
- [ ] 用户按 O 键进入圆形绘制模式
- [ ] 鼠标在画布上点击并拖拽可以绘制圆形
- [ ] 释放鼠标后，圆形固定在画布上
- [ ] 绘制过程实时显示圆形轮廓

**场景 3: 绘制直线**
- [ ] 用户按 L 键进入直线绘制模式
- [ ] 鼠标在画布上点击确定起点，拖拽确定终点
- [ ] 释放鼠标后，直线固定在画布上
- [ ] 直线具有默认的描边颜色和粗细

**场景 4: 形状选择和编辑**
- [ ] 点击形状可以选中该形状
- [ ] 选中的形状显示控制点
- [ ] 用户可以拖拽控制点调整形状大小
- [ ] 用户可以拖拽形状改变位置
- [ ] 用户可以拖拽控制点旋转形状

**场景 5: 形状属性**
- [ ] 选中形状后，右侧属性面板显示形状属性
- [ ] 用户可以修改描边颜色和粗细
- [ ] 用户可以修改填充颜色
- [ ] 对于矩形：用户可以设置圆角半径
- [ ] 对于直线：用户可以设置线条样式（实线、虚线）

#### 技术任务

- [ ] 实现快捷键监听（R、O、L）
- [ ] 创建形状绘制逻辑（矩形、圆形、直线）
- [ ] 实现 Fabric.js Shape 对象操作
- [ ] 创建形状属性面板
- [ ] 添加形状样式修改功能
- [ ] 编写测试用例

#### 工作量估算

**前端开发**: 2.5 天
**测试**: 0.5 天
**总计**: 3 天

---

### Story 1.5: 导出设计作品

**故事 ID**: US-105
**优先级**: P0 (最高)
**故事点**: 5

#### 用户故事

作为 **创作者**，我想要 **将我的设计作品导出使用**，以便 **将其发布到社交媒体平台**。

#### 验收标准

**场景 1: 复制到剪贴板**
- [ ] 用户点击顶部工具栏"复制"按钮
- [ ] 系统将当前画布内容转换为图片格式
- [ ] 复制成功后在页面顶部显示绿色提示"已复制到剪贴板"
- [ ] 用户可以直接粘贴到微信、小红书等平台（Ctrl+V）
- [ ] 复制过程耗时 < 3 秒

**场景 2: 下载为 PNG**
- [ ] 用户点击顶部工具栏"下载"按钮
- [ ] 系统弹出下载选项对话框
- [ ] 用户可以选择图片质量（1x、2x、3x）
- [ ] 用户可以选择背景透明（是/否）
- [ ] 点击"下载"后，文件自动保存到默认下载目录
- [ ] 文件名格式：cover-{YYYYMMDD-HHMMSS}.png

**场景 3: 导出设置**
- [ ] 用户可以在设置中选择默认导出格式（PNG/JPG）
- [ ] 用户可以设置默认导出质量
- [ ] 设置可以保存到本地存储

**场景 4: 导出质量验证**
- [ ] 导出的图片尺寸准确（无拉伸或压缩）
- [ ] 导出的图片中文字清晰可读
- [ ] 导出的图片中图片元素清晰
- [ ] 导出的图片颜色与画布显示一致
- [ ] 透明背景导出正确（PNG 格式）

**场景 5: 错误处理**
- [ ] 复制失败时，显示错误提示和重试按钮
- [ ] 下载失败时，显示错误提示和重试按钮
- [ ] 浏览器不支持剪贴板功能时，显示提示并建议使用下载功能

#### 技术任务

- [ ] 实现 Canvas 导出为图片功能（toDataURL）
- [ ] 实现剪贴板复制功能（Clipboard API）
- [ ] 实现文件下载功能
- [ ] 添加导出质量选项
- [ ] 实现透明背景导出
- [ ] 添加导出进度提示
- [ ] 编写端到端测试

#### 工作量估算

**前端开发**: 4 天
**测试**: 1 天
**总计**: 5 天

---

## Epic 1 总结

### 开发计划

| 故事 | 优先级 | 故事点 | 开发时间 |
|------|--------|--------|----------|
| US-101 创建画布 | P0 | 3 | 2.5 天 |
| US-102 文字编辑 | P0 | 5 | 5 天 |
| US-103 图片上传 | P0 | 5 | 5 天 |
| US-104 绘制形状 | P1 | 3 | 3 天 |
| US-105 导出作品 | P0 | 5 | 5 天 |
| **总计** | | **21** | **20.5 天** |

### 迭代规划

**迭代 1** (5 天): US-101 + US-105
- 基础画布功能 + 导出功能
- 形成最小可用闭环

**迭代 2** (5 天): US-102 文字编辑
- 实现核心文字功能
- 优先级最高的用户需求

**迭代 3** (5 天): US-103 图片上传
- 实现图片功能
- 完整的图文编辑能力

**迭代 4** (3 天): US-104 绘制形状
- 补充形状绘制功能
- 完善编辑工具集

**迭代 5** (2.5 天): 优化和测试
- 性能优化
- 集成测试
- Bug 修复

### 依赖关系

- US-101（画布）是所有其他功能的基础
- US-102、US-103、US-104 相互独立，可并行开发
- US-105（导出）依赖前三个功能完成

### 风险评估

**高风险**:
- Fabric.js 性能问题（大型画布）
- 剪贴板 API 浏览器兼容性

**中风险**:
- 图片压缩和优化
- 多设备响应式适配

**低风险**:
- 基础形状绘制

### 技术里程碑

- **里程碑 1**: 画布可创建和导出 ✅ (迭代 1)
- **里程碑 2**: 完整的文字编辑能力 ✅ (迭代 2)
- **里程碑 3**: 图片上传和编辑 ✅ (迭代 3)
- **里程碑 4**: 完整的编辑工具集 ✅ (迭代 4)
- **里程碑 5**: MVP 完成，准备发布 ✅ (迭代 5)
